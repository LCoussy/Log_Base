stages:
  - build

build:
  stage: build
  tags:
    - docker
  image: python:3.12  # Utilisation de l'image officielle Python
  before_script:
    - apt-get update && apt-get install -y zip python3 pip # Installation de zip
    - pip install --upgrade pip
    - python3 -m pip install --user pipx
    - python3 -m pip install --user --upgrade pipx
    - python3 -m pipx ensurepath --global  # Permet d'utiliser pipx globalement
    - source ~/.bashrc
    - pipx install poetry  # Installation de poetry
    - pipx inject poetry poetry-plugin-export

  script:
    - poetry lock
    - poetry install --only main
    - poetry export -f requirements.txt --output requirements-poetry.txt --without-hashes
    - mkdir dependencies-logbase
    - pip download --platform win_amd64 --no-deps --dest dependencies-logbase -r requirements-poetry.txt
    - zip -r dependencies-logbase.zip dependencies-logbase


  artifacts:
    paths:
      - dependencies-logbase.zip

  only:
    - main
